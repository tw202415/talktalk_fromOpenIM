System.register(["./index-legacy-1ff42a16.js","./clsx-legacy-f780535d.js","./i18next-legacy-3b10ec50.js","./react-legacy-86f3d07e.js","./react-virtuoso-legacy-75acb805.js","./index-legacy-8b9d889b.js","./@openim-legacy-c6a9c335.js","./react-router-legacy-b23f07b4.js","./ahooks-legacy-34a38106.js","./dayjs-legacy-0cdf6c14.js","./@babel-legacy-17757daa.js","./localforage-legacy-d5f31818.js","./react-i18next-legacy-4ed410cf.js","./electron-log-legacy-d589aeaf.js","./react-dom-legacy-4a2fe51b.js","./scheduler-legacy-8a7a76e6.js","./react-query-legacy-1e35dd33.js","./react-router-dom-legacy-53ecb489.js","./@remix-run-legacy-3e5dabd9.js","./classnames-legacy-3b4b4abd.js","./@emotion-legacy-2a329498.js","./stylis-legacy-0e2bd853.js","./@ctrl-legacy-866ef914.js","./zustand-legacy-c0d069f8.js","./use-sync-external-store-legacy-b7dea100.js","./twemoji-legacy-f58f5dc8.js","./axios-legacy-315cf952.js","./uuid-legacy-87edcc09.js","./mitt-legacy-b7d2faf6.js","./date-fns-legacy-84c044d6.js","./react-image-file-resizer-legacy-7db86fd9.js","./resize-observer-polyfill-legacy-a1ef0246.js","./scroll-into-view-if-needed-legacy-e5e19dca.js","./compute-scroll-into-view-legacy-4fd1a9b8.js","./throttle-debounce-legacy-367d0359.js","./md5-legacy-77167c53.js","./crypt-legacy-789e7ecd.js","./charenc-legacy-eee7b446.js","./is-buffer-legacy-ed3778ad.js","./react-draggable-legacy-46c7c9f7.js","./prop-types-legacy-0d444847.js","./react-use-legacy-58b93c1a.js","./copy-to-clipboard-legacy-5160011e.js","./toggle-selection-legacy-a46f82ed.js","./react-resizable-panels-legacy-b4bb5bb0.js","./xgplayer-legacy-e7bcb49c.js","./lodash-es-legacy-177cea53.js","./@ckeditor-legacy-3b8f019a.js","./color-convert-legacy-801bfb8a.js","./color-name-legacy-1aaf58fb.js","./emoji-picker-element-legacy-b4928ae9.js","./tslib-legacy-0b575964.js","./lodash-legacy-1c2339a6.js","./intersection-observer-legacy-79bb0a26.js","./react-fast-compare-legacy-be4d0a00.js"],(function(e,t){"use strict";var a,n,r,s,l,c,i,o,d,u,g,m,A,p,v,f,y,h,x,N,j,C,w,S,b,D,B,I,k,E,F,U,J,M,z,P,R,T;return{setters:[e=>{a=e.u,n=e.j,r=e.S,s=e.a,l=e.I,c=e.f,i=e.b,o=e.m,d=e.c,u=e.d,g=e.e,m=e.g,A=e.h,p=e.p,v=e.i,f=e.P,y=e.B,h=e.O,x=e.k,N=e.l,j=e.F,C=e.L},e=>{w=e.c},e=>{S=e.t},e=>{b=e.r},e=>{D=e.V},e=>{B=e.F},e=>{I=e.h,k=e.G,E=e.M,F=e.i,U=e.S,J=e.c,M=e.b},e=>{z=e.b,P=e.d,R=e.O},e=>{T=e.j},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent='._conversation-item_1cdkq_1{position:relative;margin-top:.25rem;margin-bottom:.25rem;display:flex;align-items:center;border-radius:.375rem;padding:.5rem}._conversation-item_1cdkq_1:hover{background-color:var(--primary-active)}._conversation-item-pined_1cdkq_4:after{content:"";position:absolute;right:0;top:0;border:4px solid;border-color:var(--primary) var(--primary) transparent transparent}._conversation-item_1cdkq_1 .emojione{width:16px;height:16px}@keyframes _loading_nklkj_9{0%{transform:rotate(0)}to{transform:rotate(360deg)}}._loading_nklkj_9{animation:_loading_nklkj_9 1.5s infinite}\n',document.head.appendChild(t);const H={"conversation-item":"_conversation-item_1cdkq_1","conversation-item-pined":"_conversation-item-pined_1cdkq_4"},O=({title:e,className:t,onClick:a})=>n("div",{className:w("cursor-pointer rounded px-3 py-2 text-xs hover:bg-[var(--primary-active)]",t),onClick:a,children:e}),q=b.memo((({conversation:e,closeConversationMenu:t})=>{const i=z(),[o,d]=b.useState(!1),u=a((e=>e.delConversationByCID)),g=a((e=>e.updateCurrentConversation)),m=a((e=>e.updateCurrentConversationFields));return n(r,{spinning:o,children:s("div",{className:"p-1",children:[n(O,{title:e.isPinned?S("placeholder.removeSticky"):S("placeholder.sticky"),onClick:async()=>{d(!0);try{await l.pinConversation({conversationID:e.conversationID,isPinned:!e.isPinned})}catch(a){c({error:a,msg:S("toast.pinConversationFailed")})}d(!1),t()}}),Boolean(e.unreadCount)&&n(O,{title:S("placeholder.markAsRead"),onClick:async()=>{d(!0);try{await l.markConversationMessageAsRead(e.conversationID),m({unreadCount:0})}catch(a){c({error:a})}d(!1),t()}}),n(O,{className:"text-[#FF381F]",title:S("placeholder.remove"),onClick:async()=>{d(!0);try{await l.deleteConversationAndDeleteAllMsg(e.conversationID),u(e.conversationID),e.conversationID===a.getState().currentConversation?.conversationID&&(g(),i("/chat"))}catch(n){c({error:n,msg:S("toast.deleteConversationFailed")})}d(!1),t()}})]})})})),L=async e=>{if(e?.userID)return!0;const{data:t}=await l.getSpecifiedGroupMembersInfo({groupID:e.groupID,userIDList:[g.getState().selfInfo.userID]}),a=t[0];if(!a)return!1;const{data:n}=await l.getSpecifiedGroupsInfo([e.groupID]),r=n[0];return!(r&&r.status===I.Dismissed||r.status===I.Muted&&a.roleLevel===k.Normal)&&a.muteEndTime<Date.now()},K=e=>{if(e.contentType===E.PictureMessage){const t=e.pictureElem.sourcePath?.lastIndexOf("/")??-1;return{fileName:t>-1?e.pictureElem.sourcePath.slice(t+1):S("placeholder.file"),fileSize:e.pictureElem.sourcePicture.size}}if(e.contentType===E.VideoMessage){const t=e.videoElem.videoPath.lastIndexOf("/");return{fileName:t>-1?e.videoElem.videoPath.slice(t+1):S("placeholder.file"),fileSize:e.videoElem.videoSize}}return{fileName:e.fileElem.fileName,fileSize:e.fileElem.fileSize}},Q=b.memo((({isActive:e,conversation:t})=>{const r=z(),c=b.useRef(null),[x,N]=b.useState(!1),[j,C]=b.useState(!1),D=a((e=>e.updateCurrentConversation)),B=g((e=>e.selfInfo.userID)),{droping:I}=function({domRef:e,currentConversation:t}){const[a,r]=b.useState(!1),{createFileMessage:c}=m(),{sendMessage:g}=i(),A=()=>{a&&r(!1)};return T(e.current,{onText:(e,t)=>{t?.preventDefault(),A()},onFiles:async(e,a)=>{await L(t)?(e.length&&o.confirm({title:`${S("placeholder.sendTo")}${t.showName}`,icon:null,width:320,centered:!0,className:"drop-file-moal",content:n("div",{className:"h-[240px] overflow-y-auto border-b border-t border-[var(--gap-text)] p-2",children:e.map((e=>s("div",{className:"mb-2 flex items-center",children:[n("img",{width:38,src:d,alt:"file"}),s("div",{className:"ml-3 overflow-hidden",children:[n("div",{className:"mb-1.5 truncate",children:e.name}),n("div",{className:"text-xs text-[var(--sub-text)]",children:u(e.size)})]})]},e.lastModified)))}),okText:S("confirm"),cancelText:S("cancel"),onOk:()=>{e.map((async e=>{const a=await c(e);g({message:a,recvID:t.userID,groupID:t.groupID})}))}}),A()):A()},onUri:(e,t)=>{t?.preventDefault(),A()},onDom:async({message:e},a)=>{if(!(await L(t)))return void A();const{fileName:r,fileSize:c}=K(e);o.confirm({title:`${S("placeholder.sendTo")}${t.showName}`,icon:null,width:320,centered:!0,className:"drop-file-moal",content:n("div",{className:"h-[240px] overflow-y-auto border-b border-t border-[var(--gap-text)] p-2",children:s("div",{className:"mb-2 flex items-center",children:[n("img",{width:38,src:d,alt:"file"}),s("div",{className:"ml-3 overflow-hidden",children:[n("div",{className:"mb-1.5 truncate",children:r}),n("div",{className:"text-xs text-[var(--sub-text)]",children:u(c)})]})]})}),okText:S("confirm"),cancelText:S("cancel"),onOk:async()=>{const a=(await l.createForwardMessage(e)).data;g({message:a,recvID:t.userID,groupID:t.groupID})}}),A()},onDragEnter:()=>{a||r(!0)},onDragLeave:A}),{droping:a}}({domRef:c,currentConversation:t}),k=t.groupAtType!==F.AtNormal,E=t.conversationType===U.Notification;b.useEffect((()=>{try{if(!t.latestMsg)return;JSON.parse(t.latestMsg).status===J.Sending?C(!0):C(!1)}catch(e){}}),[t.latestMsg]);const P=b.useMemo((()=>{let a="";if(t.draftText&&!e){const e=(new DOMParser).parseFromString(t.draftText,"text/html");e.querySelectorAll("img").forEach((e=>{const t=e.parentNode;t?.replaceChild(document.createTextNode(S("messageDescription.imageMessage")),e)})),a=e.body.innerHTML}else if(t.latestMsg)try{a=A(JSON.parse(t.latestMsg))}catch(n){a=S("messageDescription.catchMessage")}return p(a)}),[t.draftText,t.latestMsg,e,B]),R=v(t.latestMsgSendTime),O=t.recvMsgOpt!==M.Normal;return n(f,{overlayClassName:"conversation-popover",placement:"bottomRight",title:null,arrow:!1,open:x,onOpenChange:e=>N(e),content:n(q,{conversation:t,closeConversationMenu:()=>{N(!1)}}),trigger:"contextMenu",children:s("div",{ref:c,className:w(H["conversation-item"],"border border-transparent",(e||t.isPinned)&&"bg-[var(--primary-active)]",t.isPinned&&H["conversation-item-pinned"],I&&"!border-[var(--primary)]"),onClick:()=>{e||(D({...t}),r(`/chat/${t.conversationID}`))},children:[n(y,{size:"small",count:O?0:t.unreadCount,children:n(h,{src:t.faceURL,isgroup:Boolean(t.groupID),isnotification:E,text:t.showName})}),s("div",{className:"ml-3 flex h-11 flex-1 flex-col justify-between overflow-hidden",children:[s("div",{className:"flex items-center justify-between",children:[n("div",{className:"flex-1 truncate font-medium",children:t.showName}),n("div",{className:"ml-2 text-xs text-[var(--sub-text)]",children:R})]}),s("div",{className:"flex items-center",children:[s("div",{className:"flex min-h-[16px] flex-1 items-center overflow-hidden text-xs",children:[n("div",{className:w("mr-px whitespace-nowrap text-[var(--primary)]",{"!text-[var(--sub-text)]":O&&!k}),children:(()=>{if(t.draftText&&!e)return S("messageDescription.drftPrefix");let a="";if(O&&t.unreadCount>0&&(a=S("messageDescription.unreadCount",{count:t.unreadCount})),k)switch(t.groupAtType){case F.AtAll:a=S("messageDescription.atAllPrefix");break;case F.AtMe:case F.AtAllAtMe:a=S("messageDescription.atYouPrefix");break;case F.AtGroupNotice:a=S("messageDescription.groupAnnouncementPrefix")}return a})()}),j&&n("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAYCAYAAADpnJ2CAAAAAXNSR0IArs4c6QAAAUlJREFUSEu11stRwzAQBuB/cQGkE9JBXAKqAE7JcMqENAB3sM0x5hCnAtFBQgeUEDqAK8QsyEFBythgK6wvHo0en6TZlUTo8KW57n8w4ulIZR26eU2pbUeDMWjJzHfTkbpq22+/XSvQYgB6zHwtCrqYma0ouI+JgnWYGNiEiYC/YVXEMS9A0dyNPirL58mFWqdz3eP36MTWEcrXyVA9mXJ6r2PmiL0o/RNryAUbSNtBafnTjB8vhyo25SR/YPPfgaGYu82twUOwzuChWGcwyfUKoEHoUdUZrCLrDRmIzkLRoKBJZroIRYPAKnQD0WBwmy86A2jcuL3MCzpC4dVvsLaJjw36uzrGi5v4Xh66A9zm+pxA3mli68VuiyZUDDQrqkNFQYPezPQpAQURHYvcFnXB8v14WhlUfIV2Ahb9etdkom8ad8X/8Uz8BPWtPBLq1JROAAAAAElFTkSuQmCC",alt:"conversation_sending",className:"mr-1 h-3 w-[14px]"}),n("div",{className:"truncate text-[rgba(81,94,112,0.5)]",dangerouslySetInnerHTML:{__html:P}})]}),n("img",{className:O?"visible":"invisible",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAvtJREFUSEu9VrFyElEUPfcxpA1+gaSxDX5BSGsTXmllKFzGsRBYrSW9QFI5kCLEwvbhF0j+AL8g2NhYhLQm7HHewrLLsizLOON2LG/vufe8c8+9gv/8yC547b45FeDU/4aYyB7qjaqe7hIjM2C7Z1oi8jEanOQPtYfyLqArgO2eqYug2HR0PRq4e2UKfJA7vzCyoRTGnodzETm0v92aPs9aZRzQr4LAwHUq1SBIp2/OAXkH8Kbp6LJ9H1bMG5nhtPFGT7KArlHa6ZsRIEcWVM145uUwEsjTeTB+azq6sgCsi0g3ACFYdR092Aa6Bmjp8/5gZOkCeAGiQKBEoPW+pocrVH82RSq0IPJqQfeZW9OtNNBE0URBPcze5vLqa5ow5uqVKwvkkTqeWDSBREArHgp/C+WDL4wMdM0FJ12CP11HFzdVuYnSiYjszx4fD1Uu9yUzaN9M7H2nJbgG+KlnKkrE2B5za7q0oNdPYFulIbWhuOKVrgEGcie5FEC3b0oefSHtp91R14ooJ7dptG5si3jgCCgFPG44epx0T53+kPa95PkkSWjrFS7uQcDn8aBZQIM+FuFx47UebaU0yLDpVJJbJqQ3sdJOzwxsX26yvJWg3UtTJuV71MKSaAvPYRqnN2J5F3FP9qmOBlyqjLxu1vR8DG14Is0+lTwPgvvalvQKYGDSUYVmBB1LnscWNJgsJO/dmi6k3uG2C08Cj1S6BG33zNS2UJJS4+NpfnDGg6zjxp8coZf6oHzA0E6cJKXGKE3voVR6w41gTPCXQF5kADQ2s5Ndp3iQSNASAMYCVpHHJN78KxUGPjqftbwWpW79keN5IqLums7Jxco8vDRlQB0F7+w5EM9Eycv41hCcSXKa5WxbU1jMPdoLV4qeswoXoOg3f2xVWevD4ENrwp5arIO2WQWlBdX3ENRJTJXYHQdla9QglquFUhhZSwvp5YoBZF4TI/ezLMj2mhKUNxu51QQmUcfJDBjKH3aJKpAYqj0MdtlJN1KaJv9//e8vNt/rLDoq9U0AAAAASUVORK5CYII=",width:14,alt:"disturb"})]})]})]})})})),G=()=>n("div",{className:"my-1 flex p-3",children:n(x,{avatar:{shape:"square"},active:!0,title:!0,paragraph:{rows:1}})}),Y="_loading_nklkj_9",V=()=>{const e=g(),t="loading"===e.syncState||"loading"===e.connectState,a="failed"===e.syncState||"failed"===e.connectState,r="loading"===e.syncState?S("connect.syncing"):S("connect.connecting"),l="failed"===e.syncState?S("connect.syncFailed"):S("connect.connectFailed");return e.reinstall?null:s(j,{children:[t&&s("div",{className:"flex h-6 items-center justify-center bg-[#0089FF] bg-opacity-10",children:[n("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAa1JREFUSEvNlD0vREEUhp9jI4jEFho6X6EQhaio+AMa0Usk4g/YtSgU2ItQIxGlQscf0KDVKAgbHY1CIZFsOMzdbNyPmetugphmijnnfeY958wItSxPLxGUvAymTZO0gX7cuqq/5yV1XurAnwHMaD3ddHFHiT0px9wlOfA0C0wD+8zLczU37GBd+4A+hGduOY9BXICK+BFCP+9sU5AtO8A46GEEJWuF2ABBcbhCmXQ7MNgkSBTwjbiRszfZBSnqqG+9IKekEHcDok7eOGNBnkJN93Tks+ZHWMoSjEseU+Okg5aYeFXBQAwgMDXRyavtHdT0KivBQlEnyNBqzS1zwqI8JOoWdYgMu46Y698FKDd/UKIk/8vaSANtFOTeGubpABlKzMmLS8btwIg3MYXSjnIQgxjxOlaBEsKiC2IHBMXhkVcOWJZX1rTXv+mC3LCpzbyzhtCZBIkDXOJGeEN3fEBOZv09BSQMSBK3AVJAwoBVHSOD+W++yhLsXtRB9Szs5JCcHNq/a+OgnmHKXPg1jy4XoOpEGUc4Dja8tneQBHDM6T8DeLrkX3ReVtL+ex8qOd51km0Q4QAAAABJRU5ErkJggg==",alt:"sync",className:w("mr-1 h-3 w-3 ",Y)}),n("span",{className:" text-xs text-[#0089FF]",children:r})]}),a&&s("div",{className:"flex h-6 items-center justify-center bg-[#FF381F] bg-opacity-15",children:[n("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAk9JREFUSEu1Vk1W2mAUvTc9R5zVYQeVwArESWFIVyCuoLCC4gq0K6iuQFxBwwrqMHQirqAJdtChzgzn9Hs93/uSACGE2iOZfi/vvt97H1HxSeddA7J3ArALoAGipeaCKYAIkFtwPmb4O9rkhmUP6hh75wD7VQEs3mQEzL+UAa0ByIfDHuhdgzhIHcQQCUATrICJ1wPZA+CnWT1CzIA/HlbsVgCkc9gHvOvcsTHD4g/FjDQgz7vMgWAGDB9GmV0OkBp+c9HIGInX5zR6XHaoNgCKoNJqHKBmRiBP1N6Y08xGAVwza3daFpExJzN1tBZtxxcFCOPy3rXrgYIIHsHk2PYkBaiPAH4CEOOZrWLkGZBsA7CZ7IudMB+QG4azPt3E1H4WU/ufDLQarieu1EialHZ9CPKrjZ5h3Kgay20ZLGVq98KHyJkFSOsmV5zMhq8C0K5fgvys/ZS2PwVxBPz5yPDX7asAdN53gTff7cYzS3snAHbidg+w2xLdv6zJbV83m5M446nSlslqk/MxjRjGzcom20WyAAUKKdl4N6aWl160aHZnAOFkdrUpkFXCTJpFqojwzOOyCCUbPfVcPtJKevtyp+KUUcUS2dl9eAtBwEl8up62EqLlGYBJq0xcFkuLp8xmA10jQMLBtlrn1KB0LVakHAsX6XrBISuCE8GYs62C40Tq3JVFvZcLTg7iJHOk5XJfpJLpFSTT5JLpHAueIKZfKZmLTFT0L1KNqJrc9E1ugPnFP4n+srf0bLF17QK0Z8tRGu09IHbW7dkSVJ0tfwHCGWZ55xL+bQAAAABJRU5ErkJggg==",alt:"sync",className:"mr-1 h-3 w-3"}),n("span",{className:" text-xs text-[#FF381F]",children:l})]})]})},X=()=>{const{conversationID:e}=P(),t=a((e=>e.conversationList)),r=a((e=>e.conversationIniting)),l=a((e=>e.getConversationListByReq)),c=b.useRef(null),i=b.useRef(!0),o=b.useRef(0);b.useEffect((()=>{const e=()=>{o.current=function(e,t){let a=t+1,n=0;for(;n<e.length;){if(a>=e.length&&(a=0),e[a].unreadCount>0)return a;a++,n++}return-1}(a.getState().conversationList,o.current),o.current>-1&&c.current?.scrollToIndex({index:o.current,behavior:"smooth"})};return N.on("TRY_JUMP_TO_UNREAD",e),()=>{N.off("TRY_JUMP_TO_UNREAD",e)}}),[]);const d=b.useMemo((()=>r?function(e){const t=[];for(let a=0;a<e;a++)t.push({conversationID:`skeleton-${a}`});return t}(20):t),[r,t]);return s("div",{children:[n(V,{}),n(B,{needHidden:Boolean(e),wrapClassName:"left-2 right-2 top-1.5 flex flex-col",children:n(D,{className:"flex-1",data:d,ref:c,endReached:async()=>{i.current&&(i.current=await l(!0))},computeItemKey:(e,t)=>t.conversationID,itemContent:(t,a)=>r?n(G,{}):n(Q,{isActive:e===a.conversationID,conversation:a})})})]})};e("Chat",(()=>s(C,{className:"flex-row",children:[n(X,{}),n(R,{})]})))}}}));
