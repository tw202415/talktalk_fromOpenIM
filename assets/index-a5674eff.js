import{j as e,q as R,M as se,T as J,a,r,s as i,t as T,v as P,w as j,x as ne,y as ie,z as ce,A as D,F as V,C as me,D as de,E as M,G as Q,H as X,J as Y,K as ee,N as te,Q as pe,R as re,U as le,V as ue,W as he,X as fe,Y as ge,Z as z,_ as Z,f as be}from"./index-9718ad5b.js";import{t}from"./i18next-c73dc616.js";import{r as h}from"./react-11ad9974.js";import{L}from"./@openim-a63ca2b1.js";import{m as K}from"./md5-ffbe311d.js";import{b as ae}from"./react-router-e84d70e0.js";import{c as Ce}from"./clsx-a2f71979.js";import{u as we}from"./react-use-cc94cbd6.js";import"./dayjs-58c5dd90.js";import"./@babel-260269db.js";import"./localforage-42b533ed.js";import"./react-i18next-61ba1977.js";import"./electron-log-39892505.js";import"./react-dom-ad405c1c.js";import"./scheduler-765c72db.js";import"./react-query-c78ce74a.js";import"./react-router-dom-28f205e1.js";import"./@remix-run-1f835eaf.js";import"./classnames-c74120a4.js";import"./@emotion-c0b5c018.js";import"./stylis-5efc5547.js";import"./@ctrl-03fa0c70.js";import"./ahooks-0f0ed15d.js";import"./tslib-b745fb4d.js";import"./lodash-858845ea.js";import"./intersection-observer-90e9e37b.js";import"./react-fast-compare-922b1222.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./zustand-14da06db.js";import"./use-sync-external-store-0e343eac.js";import"./twemoji-540bbbe7.js";import"./axios-26ac709a.js";import"./uuid-4a60fe23.js";import"./mitt-f7ef348c.js";import"./date-fns-27ddccf6.js";import"./react-image-file-resizer-3cc20154.js";import"./scroll-into-view-if-needed-247ac2f3.js";import"./compute-scroll-into-view-ff36de3a.js";import"./throttle-debounce-87e7e444.js";import"./react-virtuoso-e1d9e9c1.js";import"./react-draggable-a9e3b63d.js";import"./prop-types-08c7c3df.js";import"./react-resizable-panels-2ebb3bd3.js";import"./xgplayer-ac1eb2ea.js";import"./lodash-es-039c886b.js";import"./@ckeditor-6ab12b32.js";import"./color-convert-d47c3cb3.js";import"./color-name-b7949e8c.js";import"./emoji-picker-element-ec9d8710.js";import"./crypt-5ea4a8e1.js";import"./charenc-bfd911d6.js";import"./is-buffer-793dba8c.js";import"./copy-to-clipboard-5e8b3f9a.js";import"./toggle-selection-93f4ad84.js";const ye=""+new URL("login_bg-629967c2.png",import.meta.url).href,$=n=>n.replace("https://","").replace("http://","").replace("ws://","").replace("wss://",""),B=(n,p)=>p+n,G=[{value:L.Verbose,label:e("span",{children:"Verbose"})},{value:L.Debug,label:e("span",{children:"Debug"})},{value:L.Info,label:e("span",{children:"Info"})},{value:L.Warn,label:e("span",{children:"Warn"})},{value:L.Error,label:e("span",{children:"Error"})},{value:L.Fatal,label:e("span",{children:"Fatal"})},{value:L.Panic,label:e("span",{children:"Panic"})}],Ne=({visible:n,close:p})=>{const C=o=>(console.log(j()),R().includes(o)?{IMWsUrl:$(ne()),IMApiUrl:$(R()),ChatUrl:$(ie()),LogLevel:j()}:{IMWsUrl:"",IMApiUrl:"",ChatUrl:"",LogLevel:j()}),s=(o,u)=>{localStorage.setItem("wsUrl",B(o.IMWsUrl,u?"wss://":"ws://")),localStorage.setItem("apiUrl",B(o.IMApiUrl,u?"https://":"http://")),localStorage.setItem("chatUrl",B(o.ChatUrl,u?"https://":"http://")),localStorage.setItem("logLevel",o.LogLevel.toString()),window.location.reload()},f=R().includes("http://")?"http":"https";return e(se,{width:600,footer:null,title:"Config",open:n,onCancel:p,centered:!0,children:e(J,{defaultActiveKey:f,items:[{key:"http",label:"ip+port",children:a(r,{name:"http",labelCol:{span:8},wrapperCol:{span:16},initialValues:C("http://"),onFinish:o=>s(o,!1),autoComplete:"off",children:[e(r.Item,{label:"IMWsUrl",name:"IMWsUrl",rules:[{required:!0,message:"Please input your IMWsUrl!"}],children:e(i,{addonBefore:"ws://",placeholder:"Such as：121.5.182.23:10001"})}),e(r.Item,{label:"IMApiUrl",name:"IMApiUrl",rules:[{required:!0,message:"Please input your IMApiUrl!"}],children:e(i,{addonBefore:"http://",placeholder:"Such as：121.5.182.23:10002"})}),e(r.Item,{label:"ChatUrl",name:"ChatUrl",rules:[{required:!0,message:"Please input your ChatUrl!"}],children:e(i,{addonBefore:"http://",placeholder:"Such as：121.5.182.23:10008"})}),e(r.Item,{label:"LogLevel",name:"LogLevel",rules:[{required:!0,message:"Please input your LogLevel!"}],children:e(T,{options:G})}),e(r.Item,{className:"mb-3 mt-10",wrapperCol:{offset:10,span:14},children:e(P,{type:"primary",htmlType:"submit",children:"Save"})})]})},{key:"https",label:"https+domain",children:a(r,{name:"https",labelCol:{span:8},wrapperCol:{span:16},initialValues:C("https://"),onFinish:o=>s(o,!0),autoComplete:"off",children:[e(r.Item,{label:"IMWsUrl",name:"IMWsUrl",rules:[{required:!0,message:"Please input your IMWsUrl!"}],children:e(i,{addonBefore:"wss://",placeholder:"Such as：web.rentsoft.cn/msg_gateway"})}),e(r.Item,{label:"IMApiUrl",name:"IMApiUrl",rules:[{required:!0,message:"Please input your IMApiUrl!"}],children:e(i,{addonBefore:"https://",placeholder:"Such as：web.rentsoft.cn/api"})}),e(r.Item,{label:"ChatUrl",name:"ChatUrl",rules:[{required:!0,message:"Please input your ChatUrl!"}],children:e(i,{addonBefore:"https://",placeholder:"Such as：web.rentsoft.cn/chat"})}),e(r.Item,{label:"LogLevel",name:"LogLevel",rules:[{required:!0,message:"Please input your LogLevel!"}],children:e(T,{options:G})}),e(r.Item,{wrapperCol:{offset:10,span:14},children:e(P,{type:"primary",htmlType:"submit",children:"Save"})})]})}]})})},ve=h.memo(Ne),xe="_login_1hixf_1",oe={login:xe,"login-method-tab":"_login-method-tab_1hixf_5"},H=[{value:"+86",label:"+86"}],Ie=({loginMethod:n,setFormType:p,updateLoginMethod:C})=>{var y,x;const s=ae(),[f]=r.useForm(),[o,u]=h.useState(0),{mutate:S,isLoading:c}=ce(),{mutate:F}=D(),[g,v]=h.useState(0);h.useEffect(()=>{if(g>0){const m=setTimeout(()=>{v(U=>U-1),g===1&&(clearTimeout(m),v(0))},1e3);return()=>clearTimeout(m)}},[g]);const I=m=>{var U;o===0&&(m.password=K((U=m.password)!=null?U:"")),m.phoneNumber&&(Q(m.areaCode),X(m.phoneNumber)),m.email&&Y(m.email),S(m,{onSuccess:q=>{const{chatToken:A,imToken:W,userID:_}=q.data;ee({chatToken:A,imToken:W,userID:_}),s("/chat")}})},E=()=>{const m={phoneNumber:f.getFieldValue("phoneNumber"),email:f.getFieldValue("email"),areaCode:f.getFieldValue("areaCode"),usedFor:3};n==="phone"&&delete m.email,n==="email"&&(delete m.phoneNumber,delete m.areaCode),F(m,{onSuccess(){v(60)}})},w=m=>{C(m)};return a(V,{children:[e("div",{className:"flex flex-row items-center justify-between",children:e("div",{className:"text-xl font-medium",children:t("placeholder.welcome")})}),e(J,{className:oe["login-method-tab"],activeKey:n,items:[{key:"phone",label:"手机号"},{key:"email",label:"邮箱"}],onChange:w}),a(r,{form:f,layout:"vertical",onFinish:I,autoComplete:"off",labelCol:{prefixCls:"custom-form-item"},initialValues:{areaCode:"+86",phoneNumber:(y=me())!=null?y:"",email:(x=de())!=null?x:""},children:[n==="phone"?e(r.Item,{label:t("placeholder.phoneNumber"),children:a(M.Compact,{className:"w-full",children:[e(r.Item,{name:"areaCode",noStyle:!0,children:e(T,{options:H,className:"!w-28"})}),e(r.Item,{name:"phoneNumber",noStyle:!0,children:e(i,{allowClear:!0,placeholder:t("toast.inputPhoneNumber")})})]})}):e(r.Item,{label:t("placeholder.email"),name:"email",rules:[{type:"email",message:t("toast.inputCorrectEmail")}],children:e(i,{allowClear:!0,placeholder:t("toast.inputEmail")})}),o===1?e(r.Item,{label:t("placeholder.verifyCode"),name:"verifyCode",children:a(M.Compact,{className:"w-full",children:[e(i,{allowClear:!0,placeholder:t("toast.inputVerifyCode"),className:"w-full"}),e(P,{type:"primary",onClick:E,loading:g>0,children:g>0?t("date.second",{num:g}):t("placeholder.sendVerifyCode")})]})}):e(r.Item,{label:t("placeholder.password"),name:"password",children:e(i.Password,{allowClear:!0,placeholder:t("toast.inputPassword")})}),a("div",{className:"mb-10 flex flex-row justify-between",children:[e("span",{className:"cursor-pointer text-sm text-gray-400",onClick:()=>p(1),children:t("placeholder.forgetPassword")}),e("span",{className:"cursor-pointer text-sm text-[var(--primary)]",onClick:()=>u(o===0?1:0),children:"".concat(o===0?t("placeholder.verifyCode"):t("placeholder.password")).concat(t("placeholder.login"))})]}),e(r.Item,{className:"mb-4",children:e(P,{type:"primary",htmlType:"submit",block:!0,loading:c,children:t("placeholder.login")})}),a("div",{className:"flex flex-row items-center justify-center",children:[e("span",{className:"text-sm text-gray-400",children:t("placeholder.registerToast")}),e("span",{className:"cursor-pointer text-sm text-blue-500",onClick:()=>p(2),children:t("placeholder.toRegister")})]})]})]})},Se=({loginMethod:n,setFormType:p})=>{const{message:C}=te.useApp(),[s]=r.useForm(),[f,o]=h.useState(0),[u,S]=h.useState(!1),{mutate:c}=D(),{mutate:F}=pe(),{mutate:g}=re();h.useEffect(()=>{if(f>0){const w=setTimeout(()=>{o(y=>y-1),f===1&&(clearTimeout(w),o(0))},1e3);return()=>clearTimeout(w)}},[f]);const v=w=>{w.verifyCode&&(u?F({...w,password:K(w.password)},{onSuccess(){C.success(t("toast.updatePasswordSuccess")),p(0)}}):g({...w,usedFor:2},{onSuccess(){S(!0)}}))},I=()=>{c({phoneNumber:s.getFieldValue("phoneNumber"),email:s.getFieldValue("email"),areaCode:s.getFieldValue("areaCode"),usedFor:3},{onSuccess(){o(60)}})};return a("div",{className:"flex flex-col justify-between",children:[a("div",{className:"cursor-pointer text-sm text-gray-400",onClick:()=>{p(0),s.resetFields()},children:[e(le,{rev:void 0}),e("span",{className:"ml-1",children:t("placeholder.getBack")})]}),e("div",{className:"mt-6 text-2xl font-medium",children:t("placeholder.forgetPassword")}),a(r,{form:s,layout:"vertical",labelCol:{prefixCls:"custom-form-item"},onFinish:v,autoComplete:"off",className:"mt-6",initialValues:{areaCode:"+86"},children:[u&&a(V,{children:[e(r.Item,{label:t("placeholder.password"),name:"password",help:e("span",{className:" text-xs text-gray-400",children:t("toast.passwordRules")}),rules:[{required:!0,pattern:/^(?=.*[0-9])(?=.*[a-zA-Z]).{6,20}$/,message:t("toast.passwordRules")}],hidden:!u,children:e(i.Password,{allowClear:!0,placeholder:t("toast.inputPassword")})}),e(r.Item,{label:t("placeholder.confirmPassword"),name:"password2",rules:[{required:!0,message:"Please confirm your password"},({getFieldValue:w})=>({validator(y,x){return!x||w("password")===x?Promise.resolve():Promise.reject(new Error(t("toast.passwordsDifferent")))}})],children:e(i.Password,{allowClear:!0,placeholder:t("toast.reconfirmPassword")})})]}),n==="phone"?e(r.Item,{label:t("placeholder.phoneNumber"),required:!0,hidden:u,children:a(M.Compact,{className:"w-full",children:[e(r.Item,{name:"areaCode",noStyle:!0,children:e(T,{options:H,className:"!w-28"})}),e(r.Item,{name:"phoneNumber",noStyle:!0,children:e(i,{allowClear:!0,placeholder:t("toast.inputPhoneNumber")})})]})}):e(r.Item,{required:!0,hidden:u,label:t("placeholder.email"),name:"email",rules:[{type:"email",message:t("toast.inputCorrectEmail")}],children:e(i,{allowClear:!0,placeholder:t("toast.inputEmail")})}),e(r.Item,{label:t("placeholder.verifyCode"),name:"verifyCode",hidden:u,required:!0,children:a(M.Compact,{className:"w-full",children:[e(i,{allowClear:!0,placeholder:t("toast.inputVerifyCode"),className:"w-full"}),e(P,{type:"primary",onClick:I,loading:f>0,children:f>0?t("date.second",{num:f}):t("placeholder.sendVerifyCode")})]})}),e(r.Item,{className:"mt-20",children:e(P,{type:"primary",htmlType:"submit",block:!0,children:u?t("confirm"):t("placeholder.nextStep")})})]})]})},Le=({loginMethod:n,setFormType:p})=>{const{message:C}=te.useApp(),[s]=r.useForm(),f=ae(),{mutate:o}=D(),{mutate:u}=re(),{mutate:S}=ue(),[c,F]=h.useState(0),[g,v]=h.useState(["","","","","",""]),I=h.useRef([]),E=(l,b)=>{const d=b.target.value,N=[...g];if(d.length===1)N[l]=d,v(N),l<g.length-1&&I.current[l+1].focus();else if(d.length===0){const k=[...g];k[l]="",v(k)}N.every(k=>k.length>0)&&s.submit()},w=(l,b)=>{const d=b.keyCode||b.which;if(d===8&&l>0){const N=[...g];N[l-1]="",v(N),I.current[l-1].focus()}if(d===8||d===46){const N=[...g];N[l]="",v(N)}},[y,x]=h.useState(0);h.useEffect(()=>{if(y>0){const l=setTimeout(()=>{x(b=>b-1),y===1&&(clearTimeout(l),x(0))},1e3);return()=>clearTimeout(l)}},[y]);const m=l=>{if(c===0){const d=/^1\d{10}$/;if(l.phoneNumber&&!d.test(l.phoneNumber))return C.error(t("toast.inputCorrectPhoneNumber"));o({usedFor:1,...l},{onSuccess(){x(60),F(1),setTimeout(()=>I.current[0].focus())}})}const b=g.join("");if(c===1){if(!b)return;u({...l,verifyCode:b,usedFor:1},{onSuccess(){F(2)}})}c===2&&(Q(l.areaCode),l.phoneNumber&&X(l.phoneNumber),l.email&&Y(l.email),S({verifyCode:b,autoLogin:!0,user:{nickname:l.nickname,faceURL:"",areaCode:l.areaCode,phoneNumber:l.phoneNumber,password:K(l.password),email:l.email}},{onSuccess(d){C.success(t("toast.registerSuccess"));const{chatToken:N,imToken:O,userID:k}=d.data;ee({chatToken:N,imToken:O,userID:k}),f("/chat")}}))},U=()=>{o({email:s.getFieldValue("email"),phoneNumber:s.getFieldValue("phoneNumber"),areaCode:s.getFieldValue("areaCode"),usedFor:1},{onSuccess(){x(60)}})},q=()=>{p(0),s.resetFields()},A=n==="email",W=A?"placeholder.verifyEmail":"placeholder.verifyPhoneNumber",_=A?s.getFieldValue("email"):"".concat(s.getFieldValue("areaCode")," ").concat(s.getFieldValue("phoneNumber"));return a("div",{className:"flex flex-col justify-between",children:[a("div",{className:"cursor-pointer text-sm text-gray-400",onClick:q,children:[e(le,{rev:void 0}),e("span",{className:"ml-1",children:t("placeholder.getBack")})]}),a("div",{className:Ce("mt-4 text-2xl font-medium"),children:[c===0&&e("span",{children:t("placeholder.register")}),c===1&&e("span",{children:t(W)}),c===2&&e("span",{children:t("placeholder.setInfo")})]}),a("div",{className:"mt-4 tracking-wider text-gray-400",hidden:c!==1,children:[e("span",{children:t("placeholder.pleaseEnterSendTo")}),e("span",{className:" text-blue-600",children:_}),e("span",{children:t("placeholder.verifyValidity")})]}),a(r,{form:s,layout:"vertical",labelCol:{prefixCls:"custom-form-item"},onFinish:m,autoComplete:"off",className:"mt-4",initialValues:{areaCode:"+86"},children:[n==="phone"?e(r.Item,{label:t("placeholder.phoneNumber"),hidden:c!==0,children:a(M.Compact,{className:"w-full",children:[e(r.Item,{name:"areaCode",noStyle:!0,children:e(T,{options:H,className:"!w-28"})}),e(r.Item,{name:"phoneNumber",noStyle:!0,children:e(i,{allowClear:!0,placeholder:t("toast.inputPhoneNumber")})})]})}):e(r.Item,{label:t("placeholder.email"),name:"email",rules:[{type:"email",message:t("toast.inputCorrectEmail")}],hidden:c!==0,children:e(i,{allowClear:!0,placeholder:t("toast.inputEmail")})}),a(r.Item,{label:"",hidden:c!==1,className:"mb-14 mt-8",children:[e("div",{className:"flex flex-row items-center justify-center",children:g.map((l,b)=>e(i,{ref:d=>I.current[b]=d,type:"text",maxLength:1,value:l,onChange:d=>E(b,d),onKeyUp:d=>w(b,d),className:"mr-1 h-11 w-11 text-center text-2xl"},b))}),e("div",{className:"mt-4 text-gray-400",children:y>0?a(V,{children:[a("span",{className:" text-blue-500",children:[y,"s "]}),e("span",{children:t("placeholder.regain")+t("placeholder.verifyCode")})]}):a(V,{children:[e("span",{onClick:U,className:"cursor-pointer text-blue-500",children:t("placeholder.regain")}),e("span",{children:t("placeholder.verifyCode")})]})})]}),c===2&&a(V,{children:[e(r.Item,{label:t("placeholder.nickName"),name:"nickname",hidden:c!==2,rules:[{required:!0}],children:e(i,{allowClear:!0,spellCheck:!1,placeholder:t("toast.inputNickName")})}),e(r.Item,{label:t("placeholder.password"),name:"password",rules:[{required:!0,pattern:/^(?=.*[0-9])(?=.*[a-zA-Z]).{6,20}$/,message:t("toast.passwordRules")}],children:e(i.Password,{allowClear:!0,placeholder:t("toast.inputPassword")})}),e(r.Item,{label:t("placeholder.confirmPassword"),name:"password2",dependencies:["password"],rules:[{required:!0,message:t("toast.reconfirmPassword")},({getFieldValue:l})=>({validator(b,d){return!d||l("password")===d?Promise.resolve():Promise.reject(new Error(t("toast.passwordsDifferent")))}})],className:"mb-8",children:e(i.Password,{allowClear:!0,placeholder:t("toast.reconfirmPassword")})})]}),e(r.Item,{children:e(P,{type:"primary",htmlType:"submit",block:!0,children:c===2?t("confirm"):t("placeholder.nextStep")})})]})]})},Ft=()=>{const[n,p]=h.useState(0),[C,s]=h.useState(he()),[f,o]=we(),u=h.useCallback(c=>{s(c),fe(c)},[]),S=()=>{o("".concat(z,"/").concat(Z)),be({msg:t("toast.copySuccess")})};return a("div",{className:"relative flex h-full flex-col",children:[e("div",{className:"app-drag relative h-10 bg-[var(--top-search-bar)]",children:e(ge,{})}),a("div",{className:"flex flex-1 items-center justify-center",children:[e(Pe,{}),a("div",{className:"".concat(oe.login," mr-14 h-[450px] w-[350px] rounded-md p-11"),style:{boxShadow:"0 0 30px rgba(0,0,0,.1)"},children:[n===0&&e(Ie,{setFormType:p,loginMethod:C,updateLoginMethod:u}),n===1&&e(Se,{setFormType:p,loginMethod:C}),n===2&&e(Le,{loginMethod:C,setFormType:p})]})]}),a("div",{className:"absolute bottom-3 right-3 flex cursor-pointer flex-col items-center text-xs",onClick:S,children:[e("div",{className:"text-[var(--sub-text)]",children:z}),e("div",{className:"text-[var(--sub-text)]",children:Z})]})]})},Pe=()=>{const[n,p]=h.useState(!1),C=h.useCallback(()=>p(!1),[]);return a("div",{className:"flex min-h-[420]",children:[a("div",{className:"mr-14 text-center",children:[e("div",{className:"text-2xl",onDoubleClick:()=>p(!0),children:t("placeholder.title")}),e("span",{className:"text-sm  text-gray-400",children:t("placeholder.subTitle")}),e("img",{src:ye,alt:"login_bg"})]}),e(ve,{visible:n,close:C})]})};export{Ft as Login};
